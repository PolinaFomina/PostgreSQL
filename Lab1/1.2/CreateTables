DROP TABLE IF EXISTS dosage_forms, medicaments, customers, orders, orders_medicaments CASCADE;

CREATE TABLE dosage_forms
(
	id_dosage_form integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	name text NOT NULL UNIQUE
);

CREATE TABLE medicaments
(
	id_medicament integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	name text NOT NULL,
	dosage_form integer NOT NULL REFERENCES dosage_forms ON DELETE CASCADE ON UPDATE CASCADE,
	price numeric NOT NULL CONSTRAINT positive_price CHECK (price > 0),
	UNIQUE(name, dosage_form)
);

CREATE TABLE customers
(
	id_customer integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	name text NOT NULL UNIQUE,
	address text NOT NULL,
	phone_number text NOT NULL UNIQUE
);

CREATE TABLE orders
(
	id_order integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	date date NOT NULL,
	customer integer NOT NULL REFERENCES customers ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE orders_medicaments
(
	id integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	id_order integer NOT NULL REFERENCES orders ON DELETE CASCADE ON UPDATE CASCADE,
	id_medicament integer NOT NULL REFERENCES medicaments ON DELETE CASCADE ON UPDATE CASCADE,
	quantity integer NOT NULL CONSTRAINT positive_quantity CHECK (quantity > 0)
);