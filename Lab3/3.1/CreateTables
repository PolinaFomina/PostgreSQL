DROP TABLE IF EXISTS brands, products, customers, points_of_issue, orders, orders_products CASCADE;

CREATE TABLE brands
(
	id_brand integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	name varchar(255) NOT NULL CONSTRAINT unique_name UNIQUE
);

CREATE TABLE products
(
	id_product integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	name varchar(255) NOT NULL,
	brand integer NOT NULL REFERENCES brands ON DELETE CASCADE ON UPDATE CASCADE,
	price numeric(19, 0) NOT NULL CONSTRAINT positive_price CHECK (price > 0),
	weight numeric(19, 0) NOT NULL CONSTRAINT positive_weight CHECK (weight > 0)
);

CREATE TABLE customers
(
	id_customer integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	name varchar(255) NOT NULL,
	phone_number varchar(255) NOT NULL CONSTRAINT unique_phone_number UNIQUE,
	password varchar(255) NOT NULL
);

CREATE TABLE points_of_issue
(
	id_point_of_issue integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	address varchar(255) NOT NULL CONSTRAINT unique_address UNIQUE
);

CREATE TABLE orders
(
	id_order integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	customer integer NOT NULL REFERENCES customers ON DELETE CASCADE ON UPDATE CASCADE,
	date_of_placing date NOT NULL,
	status varchar(255) NOT NULL,
	point_of_issue integer NOT NULL REFERENCES points_of_issue ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE orders_products
(
	id integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	id_order integer NOT NULL REFERENCES orders ON DELETE CASCADE ON UPDATE CASCADE,
	id_product integer NOT NULL REFERENCES products ON DELETE CASCADE ON UPDATE CASCADE,
	quantity integer NOT NULL CONSTRAINT positive_quantity CHECK (quantity > 0)
);